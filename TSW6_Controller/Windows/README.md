# Train Sim World 6 – External API Firewall Setup

(c) 2025 Felix Lindemann. All rights reserved.  
Dieses Setup wird ohne Garantie bereitgestellt („as is“).  
Nutzung, Veränderung und Weitergabe erfolgen auf eigenes Risiko.  
Es besteht keinerlei Anspruch auf Funktionsfähigkeit oder Support.

---

Dieses Verzeichnis enthält PowerShell-Skripte und Batch-Dateien, um die Windows-Firewall
für den Zugriff auf die **TSW6 External Interface API (Port 31270/TCP)** einzurichten.

---

## Verzeichnisstruktur

```text
.
├── Enable-TSW6-API-Access.ps1      # Firewallregel aktivieren (Dialog: Subnetz oder einzelne IP)
├── Disable-TSW6-API-Access.ps1     # Firewallregel wieder entfernen
├── Enable-TSW6-API-Access.cmd      # Batch-Datei für einfachen Start (öffnet .ps1 als Admin)
├── Disable-TSW6-API-Access.cmd     # Batch-Datei zum Entfernen (öffnet .ps1 als Admin)
└── README.md                       # Diese Anleitung
```

---

## Voraussetzungen

- Windows 10 oder neuer  
- Administratorrechte  
- TSW6 ist mit `-HTTPAPI` gestartet  
- In der `engine.ini` wurde der Eintrag für den Listener angepasst:

```ini
[HTTPServer.Listeners]
bind=0.0.0.0
```

Dadurch lauscht die API auf allen Netzwerkinterfaces.

---

## Schritt 1 – Firewallregel aktivieren

Mit `Enable-TSW6-API-Access.ps1` kannst du die Firewallregel erstellen.  
Das Script fragt dich interaktiv:

1. Gesamtes Subnetz freigeben (alle Geräte im privaten Netzwerk)  
2. Nur eine bestimmte IP-Adresse freigeben (z. B. dein Controller)  

### Startmöglichkeiten

- Direkt in **PowerShell (als Administrator)**:
```powershell
.\Enable-TSW6-API-Access.ps1
```

- Oder per **Doppelklick auf die Batch-Datei**:
```bat
Enable-TSW6-API-Access.cmd
```

---

## Schritt 2 – Firewallregel prüfen

Mit folgendem Befehl kannst du kontrollieren, ob die Regel aktiv ist:

```powershell
Get-NetFirewallRule -DisplayName "TSW6 External API"
```

Optional Details zur Portbindung anzeigen:

```powershell
Get-NetFirewallPortFilter -AssociatedNetFirewallRule (Get-NetFirewallRule -DisplayName "TSW6 External API")
```

---

## Schritt 3 – Firewallregel wieder löschen

Zum Entfernen gibt es zwei Wege:

- Direkt in **PowerShell (als Administrator)**:
```powershell
.\Disable-TSW6-API-Access.ps1
```

- Oder per **Doppelklick auf die Batch-Datei**:
```bat
Disable-TSW6-API-Access.cmd
```

Nachkontrolle:
```powershell
Get-NetFirewallRule -DisplayName "TSW6 External API"
```
(Bei erfolgreicher Entfernung wird keine Regel mehr angezeigt.)

---

## Schritt 4 – Sicherheitshinweise

- Die API ist **unverschlüsselt (http)** – daher nur im lokalen Netzwerk einsetzen.  
- Standardmäßig öffnet die Regel Port 31270 für **alle Geräte im privaten oder Domänen-Netzwerk**.  
- Falls du nur bestimmte Geräte zulassen willst, wähle im Dialog **Option 2** und trage die IP-Adresse ein.  
- Beispiel für manuelle Einschränkung im Script:  

```powershell
New-NetFirewallRule -DisplayName "TSW6 External API" -Direction Inbound -Action Allow -Protocol TCP -LocalPort 31270 -RemoteAddress 192.168.1.42 -Profile Private,Domain
```

So darf nur dieses Gerät auf die API zugreifen.

---

© 2025 – TSW6 External Interface Setup by Felix Lindemann

                                                                                                                                                                                        
                                                                                                                                                                                        
                                                                 #####                                                                                                                  
                                                 ############### #########                                                                                                              
                                            #########++++++++########--+####                                                                                                            
                                          #####+-.....-------...--+###..--#### ####                                                                                                     
                                       ####+-...-----------------------.---+#######                                                                                                     
                                     ####-..---------------------------------########                                                                                                   
                                   ####-..------------------------------------+-#########                                                                                               
                                  ###-..---------------------------------------...-+#####                                                                                               
                                ####..--------------------------------------------#####                                                                                                 
                               ###+.----------------------------------+-------------+###                                                                                                
                              ###------------+#+-----------+#-------+##-----#-------.-###                                                                                               
                              #####+------+###+--------+####------#####---####+-----#-+##                                                                                               
                              #####-----+++##+-----+###+##+----+##+--##+##+-+##+----######                                                                                              
                                ##+--------##++####+-..+##+####+-...+##+-...-##-+----#####                                                                                              
                                ##+------####++--.....-+-----................+#------#####                                                                                              
                                ##+-----##-..................................-##-----####                                                                                               
                                ###-----##....................................##-----##########################                                                                         
                                ###----+#-....--------............--------....-##---+##+++++++++++++####################                                                                
                           #########---##-..-+#########-........-+#########+-..##---##-......................--++#############                                                          
                ####################+--##..----......--..........---.....----..+#+--##................................--+##########                                                     
             ###########++++---+#####+##-......--+++--............---++---.....-##+####+....................................--+########                                                 
           #####+-............###---+###-....+#-+###-++..........-+-####+#+....-###+---##+.......................................-+#######                                              
          ####-..............+##----.+##-...-+.-####+.-..........-.-####+.+-...-##+..-..##+..........................................-+#######                                          
         ###+................##+.-+##+##-.......####-...............####-......-##++#+-.-##.................................-.----------+#######                                        
        ####.................##+...-####-........-+-................----.......-####-...-#+......................-#################################                                     
        ###+.................+##...+#+##-...............-+-....................-##+#+...##-.......................+######++#+++++++++++++++++#########                                  
        ###+..................##-..-+-+#+..............-#+.....................+#+--+..-##..........................-#####++++++++++++++++++++++########                                
        ###+..................-##-...-+##..............+#+-..---...............+#----.-##..............................+#####++++++++++++++++++++++#######                              
        ####++++##########.....+##+-.--##-.............-+#####+-..............-##----+##-................................-#####++++++++++++++++++++++#######                            
        ##################-......####++##+....................................+##++###+.....................................+#####+++++++++++++++++++++#######                          
        ##################-........-++####-.......-#+--..........--++-.......-#####+-........----......--------...----------..-#####++++++++++++++++++++++######                        
        ##################-.............+##-.......--+##++++++++##+--.......-###.............+++-....-+++++++++...+++++++++-.....+#####+++++++++++++++++++++######                      
        ##################-..............###-..........----------..........-###.............-+++...-++++--...-...-+++-.............-######+++++++++++++++++++######                     
        ##################-..........-+######+-..........................-+####+-...........++++..-++++..........++++.................-##############################                   
        ##################-........-###########+-......................-##########-........-+++-..++++..........-++++-----................-++++++++++++++++++#+########                 
        ##################-.......+##+++##########+--..............-+##########++##+.......++++..-+++-..........-++++++++-.........................................-####                
        ##################-......-##++++##############+---....--+##############+++##+......+++-..-+++-..........+++------............................................####               
        ##################.......##++++++++########--++##########++--########+++++###.....-+++-..-++++.........-+++-..................................................+####             
        ###+.....................###+#++++++++++###+----------------+######+++##+###+.....++++....++++--...-...-+++-...................................................-####            
        ###+......................#####+..-+++++++####+-----------+####+++++#######+.....-+++-.....+++++++++...++++++++++..........................########+-............####           
        ###+...................-#########+--+++++++++#####-----+####+++.-+###########+...----........-------...----------..........................-##+----+##-...........####          
        ###+-----...........-+##+-.-+++##############+++####+####+++++-+###########-+###+............................................................+#+.....+#+...........+###         
        ###++++++++++++++++###+---++++++++############++++#####+###############++++---+###+...........................................................-##-....-##-..........####        
        ###+++++++++++++++###++++++++++++++++####...--++++####+############+++++++++++++####+...........................................................+#+-....-##-.........###        
        ###+++++++++++++##+-++++++++++++++++++++#+........+###++++#######++++++++++++++##+####++++++++++++------.........................................-+#+....-##+........-###       
        ###++++++++++++##+...++##++++++++++++++++++-------+###+########+++++++++++++++###++####++++++++++++++++++++++---...................................-#########.........####      
        ###-..........##+....++###+++++++++-..-+++++++++++####+######++++++++++++++++####++++###+++++++++++++++++++++++++++---................................................-###      
        ###-.........+#+...-++++###++++++-......+######+++####++++++++++-..--++++++++####++++-###++++++++++++++++++++++++++++++++--.................................----++++++####      
        ###-........-##.....++++###+--......-+###############+++++++++-.......-+++++####++++..-##+--++++++++++++++++++++++++++++++++++--.......................-####++----.....+###     
        ###-........###+-....+++###-........#################++++++-.........-+++++#####++-....+##............-----+++++++++++++++++++++++--................-##+-...............###     
        ###-.......+##+++++...++###-..-......+###+++++++++###++++++++-..--++++++########-.....+###+.....................---++++++++++++++++++++--.........-##-..................###     
        ###+--....-##++++++++++++#######++++-.++++++++++++####+++++++++++++++++#######+......+++###............................---++++++++++++++++++--...+#+....................###     
        #############++###+++++++#####+++++++++++++++++#++####+++++++++#####++++######-.....+++++###.................................---++++++++++++++++###-....................###     
        ############+++######++++#####+#++#+++++++++++++-.+##+++++##############+++###-.+###++++####-......................................---++++++++++##+++++++------------+++###     
        ###########++++#######+++#########+...-+++++++-...-##-.+++################+###-####++########.............................................---++##++++++++++++++++++++++####     
        ###########+++++++######+#########........--......-##--+++###########++++++#######+++#########.................................................##.------+++++++++++++-+###      
        ##########+++++++++###############+++-.....--+-..-+###+++++++++#+++++++++++######++++++#++++#######+++++------.................................#+.....................+###      
        #########..+++#####################+++++++++++++++####++++++++++++++++++++######++++####+++++#############################+++++-------.........##....................-###       
        ########...-######################++++##++++++++++####+++###++++############################++####++++++++++++###################################-...................###        
        #######-.-+##+++......-#####+++++++##########+++++################################+---+######+#######++++++++++++++++++++++++++++++++++++++#######-................+####        
        #######.++++++++++++++++#####++++###+--.--+##+++################------+#########+-....+++++#############+++++++++++++++++++++++++++++++++++++++++##+-............+####          
        #######+++##++#++++++++++#########+++++##############################+++######++++++#++++++##++############+++++++++++++++++++++++++++++++++++++++####+-------+######           
        #######+#####+++++++++#############################################################++++++++#############################++++++++++++++++++++++++++###################           
        ##############+#+++++########+--###++++###+++++############+++++####+++####++########++++++##################################################################+-..+###           
        ############-..-+++####+###-...+##+++++####++++############+++++####+++++##+.-+########++++################################################################+---..+###           
        ###########+...++++###+##+-....###++##########+############++###########+###...-###+###++++##########################################################################           
        ##########-....-++###+###-....-####+#########++############++####+++####+##+....-##+###.+++##########################################################################           
        ##########........##++##+.......+###+++###+++++############+++############+.....-###+##.++###########################################################################           
        ###########-.-##++###+##+........-+########+++++++++++++++++++++########+-......-######.+############################################################################           
        #################+######+.....-....---++++########################++++--...-....+#####++#############################################################################           
        #########################-....-++--.......-####################+-.....--++##-..-#####################################################################################           
        #########################+......--+##+++++###############################+-....+########+..............###+--......--###-----+####+----+####+----#####+-...---#######           
        ##########################+..+++--...---+#######################+-----..----.-+#########+..............##-............+#-....-####.....-####-...-###-..........+#####           
        ###################+++++####---++##+++++########++###+####################+-+############++++-....+++++#-....+###+....-##....-###-......####....+##-....+#+-...-#####           
        ################+++++++++++###++----+##############################++----+###################+....######-....#####+++++##.....###.......+##-....##+....##############           
        ###############+++++++++++++++#################################++##########+++++#############+....######-.....--+########-....##+...-...-##....+##....-+-..--+#######           
        #############+++++++++++++++++++++###########################++++++++++++++++++++############+....#######-.........--#####....+#....#....#+....##+.............######           
        #############++++++++++++++++++++++#######+++++####+++++####+++++++++++++++++++++############+....#########++--.......+###....-+...-#-...#-...+##+.....+##+.....#####           
        #############+++++++++++++++++####++########+++++++++++####++####+++++++++++++++++###########+....###############+.....###-...-....##+...+....####....+####+....#####           
        #############++++++++++++++++++####++#########++++++++#########+++++++++++++++++++###########+....######-...+#####-....###+.......-###.......-####-...-####-....#####           
        #############+++++++++++++++++++#################++++#########+++++++++++++++++++############+....######.....--+--....+####.......####-......#####+....----....+#####           
        ##############+++++++++++++++++++############################++++++++++++++++++++############+....######+-...........+#####-.....-####-.....-#######-........-+######           
        ##############################################################################################++++#########+------+###---+##+++++######+++++##########++--++#########           
        #####################################################################################################################--+..###########################################           
        ##########+--...--+#########+--...--+#######+---+#####---+###+-------------####---------+##########+++++++++#######++++-.+#########+++++++++++####+--------+#########           
        #########-..........+#####+...........-#####-....+####...-###+.............####...........-######++++++--+++++#####++-....+#######+++++++++++++###...........-#######           
        ########....-###+....#####....+###+-...-####-.....+###...-####++++-...+++++####....++++....-####+-++-+###+++++-####+++++##########++++-++-++++####....++++-...-######           
        #######+...-######+++####-...-######....####-......+##...-########-...+########...-####+...-####+++++######-++++###+++++##########+++++###########....####+....######           
        #######-...+#############....+######....+###-...-...+#...-########-...#########....++++....-####-++++######+++++###+++++##########++++++++++++####....++++-...-######           
        #######-...+#############-...+######....+###-...#-...+...-########-...#########...........-#####-++++######+++++###+++++##########++++++++++++####...........-#######           
        #######+...-######+++####-...-######....####-...##-......-########-...#########....--....+######+++++######-++++###+++++##########+++-+#+++++#####....--....+########           
        ########....-+##+....#####....-+##+....+####-...###-.....-########-...#########...-###....######+-+++++##+++++-####++++++#########+++-############....###....+#######           
         ########-..........+######-..........+#####-...####-....-########-...#########...-###+....######+++++++++++-+#####+++++++--+-+###+++-+++++++-####....###+....+#####            
         #########++------+#########+-------+#######----#####----+########----#########----####+----#######+++++++++#######++++++++++++###+++++++++++-####----####+----#####            
          #################################################################################################################################################################             
           ###############################################################################################################################################################              
              ##########################################################################################################################################################                
                  #################################################################################################################################################                     
                                                                                                                                                                                        
